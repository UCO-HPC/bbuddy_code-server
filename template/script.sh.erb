---

# Purge the environment to avoid conflicts
module purge

# Load requested version
module load <%= context.version %>

<%- unless context.modules.blank? -%>
# Load the requested modules
module load <%= context.modules %>

#List loaded modules
module list

<%- end -%>

# Expose the hased password to the server.
export PASSWORD="$password"

# Tell user where code server will be started
echo "$(date): Preparing to run on ${compute_node}:$port"

#
# Start Code Server.
#
echo "$(date): Started code-server"
echo ""

code-server \
    --auth="password" \
    --bind-addr="0.0.0.0:${port}" \
    --proxy-domain "
    --verbose
